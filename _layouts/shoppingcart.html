---
layout: default
---

<div class="container mt-5 mb-5">
  <div class="d-flex align-items-center mt-5 mb-5">
    <a href="{{site.url}}{{site.baseurl}}/" class="d-flex align-items-center text-decoration-none">
      <i class="fa fa-long-arrow-alt-left mr-2"></i>
      <span>Volver</span>
    </a>
  </div>

  <div id="carrito-listado" class="container"></div>

    <!-- Total del carrito -->
    <div id="total-carrito" class="mt-4 text-center">
      <h4>Total: $<span id="total-sum"></span></h4>
    </div>

  <div class="cart mt-4 d-flex flex-column align-items-center text-center">
    <button class="btn btn-success" onclick="clearLocalStorage()">LIMPIAR CARRITO</button>
  </div>
  <div class="cart mt-4 d-flex flex-column align-items-center text-center">
    <button class="btn btn-success" onclick="clearLocalStorage()">REALIZAR PEDIDO</button>
  </div>


</div>

<script>
  renderizarCarrito();

  function renderizarCarrito() {
    const carrito = JSON.parse(localStorage.getItem('carrito')) || [];
    const contenedor = document.getElementById('carrito-listado');
    contenedor.innerHTML = '';

    if (carrito.length === 0) {
      contenedor.innerHTML = '<p class="text-center text-muted">Tu carrito está vacío.</p>';
      document.getElementById('total-sum').textContent = '0';
      return;
    }

    carrito.forEach((producto) => {
      if (!producto.uid) {
        producto.uid = crypto.randomUUID();
      }

      const item = document.createElement('div');
      item.classList.add('mb-3');
      item.id = `producto-${producto.uid}`;

      item.innerHTML = `
        <div class="d-flex align-items-center justify-content-between text-white">
          <div class="d-flex align-items-center">
            <img src="${producto.image}" alt="${producto.name}" class="img-thumbnails me-3" style="width: 70px; height: 70px; object-fit: cover;">
            <div>
              <h5 class="mb-1">${producto.name}</h5>
              <small><strong>Tela:</strong> ${producto.tela} <strong>Genero:</strong> ${producto.genero} <strong>Talla:</strong> ${producto.talla} <strong>Color:</strong> ${producto.color}</small>
              <br>
              <strong class="me-3">VALOR: $${(producto.price * producto.cantidad).toLocaleString('es-ES')}</strong>
            </div>
          </div>

          <div class="d-flex align-items-center">
            <div class="d-flex align-items-center gap-2">
              <button class="btn btn-outline-secondary btn-sm" onclick="cambiarCantidad('${producto.uid}', -1)">-</button>
              <span class="fs-5">${producto.cantidad}</span>
              <button class="btn btn-outline-secondary btn-sm" onclick="cambiarCantidad('${producto.uid}', 1)">+</button>
            </div>
            <button class="btn r btn-sm" onclick="eliminarProducto('${producto.uid}')">
              <i class="fa fa-trash"></i>
            </button>
          </div>
        </div>
      `;

      contenedor.appendChild(item);
    });

   
    calcularTotal(carrito);
    localStorage.setItem('carrito', JSON.stringify(carrito));
  }

  function calcularTotal(carrito) {
    const total = carrito.reduce((sum, producto) => sum + (producto.price * producto.cantidad), 0);
    document.getElementById('total-sum').textContent = total.toLocaleString('es-ES');
  }

  function cambiarCantidad(uid, cambio) {
    let carrito = JSON.parse(localStorage.getItem('carrito')) || [];
    const producto = carrito.find(p => p.uid === uid);

    if (producto) {
      producto.cantidad += cambio;
      if (producto.cantidad < 1) producto.cantidad = 1;
      if (producto.cantidad > 99) producto.cantidad = 99;

      localStorage.setItem('carrito', JSON.stringify(carrito));

      const contenedor = document.getElementById(`producto-${uid}`);
      if (contenedor) {
        contenedor.querySelector('span.fs-5').textContent = producto.cantidad;
        contenedor.querySelector('strong.me-3').textContent =
          `VALOR: $${(producto.price * producto.cantidad).toLocaleString('es-ES')}`;
      }
      actualizarContadorCarrito();
      calcularTotal(carrito);
    }
  }

  function eliminarProducto(uid) {
    let carrito = JSON.parse(localStorage.getItem('carrito')) || [];
    carrito = carrito.filter(p => p.uid !== uid);
    localStorage.setItem('carrito', JSON.stringify(carrito));

    const productoElemento = document.getElementById(`producto-${uid}`);
    if (productoElemento) {
      productoElemento.remove();
    }

    if (carrito.length === 0) {
      document.getElementById('carrito-listado').innerHTML = '<p class="text-center text-muted">Tu carrito está vacío.</p>';
      document.getElementById('total-sum').textContent = '0';
    }

    if (typeof actualizarContadorCarrito === 'function') {
      actualizarContadorCarrito();
    }

    calcularTotal(carrito);
  }

  function clearLocalStorage() {
    localStorage.clear();
    location.reload();
  }
</script>
